# 情绪词汇数据加载功能说明

## 概述

本项目已升级为支持外部JSON数据加载的架构，将情绪数据从HTML代码中分离出来，提高了数据的可维护性和可扩展性。

## 文件结构

```
emotion-valence-arousal-chart/
├── index.html                 # 主应用文件（已更新为异步加载）
├── data.json                  # 外部情绪数据文件
├── test-data-loading.html     # 数据加载测试工具
├── assets/
│   └── css/
│       └── index.css         # 样式文件（包含加载动画）
└── project-md/
    └── project-analysis.md   # 项目分析文档
```

## 数据文件格式 (data.json)

### JSON结构
```json
[
  {
    "category": "情绪类别",
    "level": "强度等级",
    "words": [
      {
        "word": "情绪词汇",
        "coord": [x坐标, y坐标]
      }
    ]
  }
]
```

### 数据验证规则
- **category**: 字符串，情绪类别名称
- **level**: 字符串，强度等级（如："轻微 (Mild)"、"中等 (Medium)"、"强烈 (Strong)"）
- **words**: 数组，包含该类别下的所有词汇
- **word**: 字符串，中文情绪词汇
- **coord**: 数组，[x, y]坐标值，范围：-1.0 到 1.0

### 示例数据
```json
[
  {
    "category": "快乐",
    "level": "轻微 (Mild)",
    "words": [
      {"word": "愉快", "coord": [0.6, 0.3]},
      {"word": "欣慰", "coord": [0.7, 0.1]}
    ]
  }
]
```

## 功能特性

### 1. 异步数据加载
- 使用 `fetch()` API 异步加载外部JSON数据
- 支持HTTP和本地文件协议
- 自动处理网络错误和文件不存在的情况

### 2. 错误处理机制
- **网络错误处理**: 自动检测网络连接问题
- **数据格式验证**: 验证JSON结构和数据完整性
- **坐标范围检查**: 确保坐标值在有效范围内[-1, 1]
- **备用数据模式**: 当外部数据加载失败时自动切换到备用数据

### 3. 加载状态显示
- **加载指示器**: 旋转动画显示加载进度
- **页面遮罩**: 加载时降低主界面透明度
- **进度提示**: 显示"正在加载数据..."的提示信息

### 4. 用户交互
- **错误通知**: 右上角弹出式错误提示
- **自动消失**: 错误提示5秒后自动隐藏
- **手动关闭**: 点击×按钮可手动关闭
- **重试按钮**: 控制面板提供"重新加载数据"按钮

## 错误类型和处理

### 网络错误
- **404错误**: data.json文件不存在
- **网络连接**: 无法访问服务器或本地文件
- **CORS错误**: 跨域访问限制（HTTP环境）

### 数据格式错误
- **JSON格式错误**: 文件不是有效的JSON格式
- **结构错误**: 缺少必要字段或字段类型错误
- **坐标错误**: 坐标值超出有效范围

### 处理策略
1. **显示错误信息**: 详细说明错误原因
2. **备用数据**: 自动加载简化示例数据
3. **功能限制**: 备用模式下功能受限
4. **重试机制**: 用户可手动重试加载

## 部署要求

### 开发环境
```bash
# 本地服务器运行
python -m http.server 8000
# 或
npx serve .
```

### 生产环境
- **Web服务器**: 支持静态文件服务
- **MIME类型**: 确保JSON文件正确返回`application/json`
- **缓存策略**: 建议为JSON文件设置适当的缓存策略

## 性能优化

### 加载优化
- **异步加载**: 不阻塞页面渲染
- **数据缓存**: 浏览器自动缓存JSON文件
- **错误恢复**: 快速降级到备用数据

### 数据验证优化
- **快速验证**: 基本结构检查
- **详细验证**: 完整性验证（可选）
- **范围检查**: 坐标值有效性验证

## 扩展指南

### 添加新数据
1. 编辑 `data.json` 文件
2. 添加新的情绪类别或词汇
3. 遵循现有数据格式和约束
4. 确保坐标值在有效范围内

### 修改数据源
```javascript
// 在 loadEmotionData() 函数中修改
const response = await fetch('./new-data-source.json');
```

### 自定义验证规则
```javascript
// 修改 validateDataStructure() 函数
function validateDataStructure(data) {
    // 自定义验证逻辑
    return isValid;
}
```

## 测试工具

### test-data-loading.html
提供了完整的数据加载测试工具，包含：
- **数据加载测试**: 测试JSON文件加载
- **数据结构验证**: 验证数据完整性和格式
- **统计信息显示**: 显示数据摘要和统计

### 使用方法
1. 在浏览器中打开 `test-data-loading.html`
2. 点击相应测试按钮
3. 查看测试结果和详细信息

## 故障排除

### 常见问题

**Q: 数据加载失败，显示404错误**
A: 检查data.json文件是否存在于正确位置，确保Web服务器可访问该文件

**Q: 控制台显示CORS错误**
A: 使用HTTP服务器而非直接打开HTML文件，或配置服务器允许跨域访问

**Q: 数据显示不完整**
A: 检查data.json文件格式是否正确，使用测试工具验证数据完整性

**Q: 页面显示备用数据**
A: 外部数据加载失败，检查网络连接和文件路径，或查看控制台错误信息

### 调试方法
1. 打开浏览器开发者工具
2. 查看Console标签页的错误信息
3. 使用Network标签页检查数据加载状态
4. 使用测试工具验证数据格式

## 版本信息

- **当前版本**: 2.0
- **更新时间**: 2025年12月25日
- **主要更新**: 外部JSON数据加载支持
- **兼容性**: 支持现代浏览器的ES6+特性

## 技术支持

如遇到技术问题，请：
1. 检查浏览器控制台错误信息
2. 使用测试工具验证数据完整性
3. 确认服务器配置正确
4. 查看项目文档了解详细使用说明